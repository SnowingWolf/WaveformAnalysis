#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
é…ç½®ç®¡ç†ç»¼åˆç¤ºä¾‹

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ WaveformAnalysis çš„é…ç½®ç®¡ç†åŠŸèƒ½ï¼š
1. list_plugin_configs() - æŸ¥çœ‹æ‰€æœ‰æ’ä»¶å¯ç”¨çš„é…ç½®é€‰é¡¹
2. show_config() - æŸ¥çœ‹å½“å‰é…ç½®å€¼å’Œä½¿ç”¨æƒ…å†µ
3. set_config() - è®¾ç½®å…¨å±€å’Œæ’ä»¶ç‰¹å®šé…ç½®
"""

from waveform_analysis.core.context import Context
from waveform_analysis.core.plugins.builtin.standard import (
    RawFilesPlugin,
    WaveformsPlugin,
    StWaveformsPlugin,
)


def main():
    print("=" * 80)
    print("é…ç½®ç®¡ç†ç»¼åˆç¤ºä¾‹")
    print("=" * 80)

    # ====================================================================
    # 1. åˆ›å»º Context å¹¶æ³¨å†Œæ’ä»¶
    # ====================================================================
    print("\næ­¥éª¤ 1: åˆ›å»º Context å¹¶æ³¨å†Œæ’ä»¶")
    print("-" * 80)

    ctx = Context(storage_dir="./strax_data")
    ctx.register(
        RawFilesPlugin(),
        WaveformsPlugin(),
        StWaveformsPlugin(),
    )
    print("âœ“ å·²æ³¨å†Œ 3 ä¸ªæ’ä»¶: raw_files, waveforms, st_waveforms")

    # ====================================================================
    # 2. æŸ¥çœ‹æ‰€æœ‰æ’ä»¶çš„é…ç½®é€‰é¡¹ï¼ˆäº†è§£æœ‰å“ªäº›é…ç½®å¯ç”¨ï¼‰
    # ====================================================================
    print("\n\næ­¥éª¤ 2: æŸ¥çœ‹æ‰€æœ‰æ’ä»¶çš„é…ç½®é€‰é¡¹")
    print("-" * 80)
    print("ä½¿ç”¨ list_plugin_configs() æŸ¥çœ‹æ‰€æœ‰æ’ä»¶æä¾›çš„é…ç½®é€‰é¡¹...")
    input("\næŒ‰ Enter ç»§ç»­...")
    ctx.list_plugin_configs()

    # ====================================================================
    # 3. è®¾ç½®å…¨å±€é…ç½®
    # ====================================================================
    print("\n\næ­¥éª¤ 3: è®¾ç½®å…¨å±€é…ç½®")
    print("-" * 80)
    print("è®¾ç½®ä¸€äº›å…¨å±€é…ç½®é¡¹ï¼ˆä¼šå½±å“å¤šä¸ªæ’ä»¶ï¼‰:")
    print("  - n_channels: 4")
    print("  - data_root: 'DAQ_v2'")
    print("  - start_channel_slice: 10")

    ctx.set_config({
        'n_channels': 4,
        'data_root': 'DAQ_v2',
        'start_channel_slice': 10,
    })
    print("\nâœ“ å…¨å±€é…ç½®å·²è®¾ç½®")

    # ====================================================================
    # 4. æŸ¥çœ‹é…ç½®ä½¿ç”¨æƒ…å†µ
    # ====================================================================
    print("\n\næ­¥éª¤ 4: æŸ¥çœ‹é…ç½®ä½¿ç”¨æƒ…å†µ")
    print("-" * 80)
    print("ä½¿ç”¨ show_config() æŸ¥çœ‹é…ç½®é¡¹è¢«å“ªäº›æ’ä»¶ä½¿ç”¨...")
    input("\næŒ‰ Enter ç»§ç»­...")
    ctx.show_config()

    # ====================================================================
    # 5. è®¾ç½®æ’ä»¶ç‰¹å®šé…ç½®
    # ====================================================================
    print("\n\næ­¥éª¤ 5: è®¾ç½®æ’ä»¶ç‰¹å®šé…ç½®")
    print("-" * 80)
    print("ä¸º waveforms æ’ä»¶è®¾ç½®ç‰¹å®šé…ç½®:")
    print("  - channel_executor: 'process'")
    print("  - channel_workers: 2")

    ctx.set_config({
        'channel_executor': 'process',
        'channel_workers': 2,
    }, plugin_name='waveforms')
    print("\nâœ“ æ’ä»¶ç‰¹å®šé…ç½®å·²è®¾ç½®")

    # ====================================================================
    # 6. å†æ¬¡æŸ¥çœ‹é…ç½®ï¼ˆè§‚å¯Ÿæ’ä»¶ç‰¹å®šé…ç½®ï¼‰
    # ====================================================================
    print("\n\næ­¥éª¤ 6: æŸ¥çœ‹æ›´æ–°åçš„é…ç½®")
    print("-" * 80)
    print("æ³¨æ„è§‚å¯Ÿã€Œæ’ä»¶ç‰¹å®šé…ç½®ã€éƒ¨åˆ†...")
    input("\næŒ‰ Enter ç»§ç»­...")
    ctx.show_config()

    # ====================================================================
    # 7. æŸ¥çœ‹ç‰¹å®šæ’ä»¶çš„è¯¦ç»†é…ç½®
    # ====================================================================
    print("\n\næ­¥éª¤ 7: æŸ¥çœ‹ç‰¹å®šæ’ä»¶çš„è¯¦ç»†é…ç½®")
    print("-" * 80)
    print("ä½¿ç”¨ show_config('waveforms') æŸ¥çœ‹å•ä¸ªæ’ä»¶çš„è¯¦ç»†é…ç½®...")
    input("\næŒ‰ Enter ç»§ç»­...")
    ctx.show_config('waveforms')

    # ====================================================================
    # 8. å¯¹æ¯”ä¸¤ç§é…ç½®æŸ¥çœ‹æ–¹æ³•
    # ====================================================================
    print("\n\næ­¥éª¤ 8: å¯¹æ¯”ä¸¤ç§é…ç½®æŸ¥çœ‹æ–¹æ³•")
    print("-" * 80)
    print("\nlist_plugin_configs() vs show_config() çš„åŒºåˆ«ï¼š\n")
    print("ğŸ“¦ list_plugin_configs():")
    print("   â€¢ æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„é…ç½®é€‰é¡¹ï¼ˆåŒ…æ‹¬é»˜è®¤å€¼ï¼‰")
    print("   â€¢ é€‚åˆäº†è§£æ’ä»¶æ”¯æŒå“ªäº›é…ç½®")
    print("   â€¢ æ˜¾ç¤ºå¸®åŠ©æ–‡æœ¬å’Œç±»å‹ä¿¡æ¯")
    print("   â€¢ åŒºåˆ†é»˜è®¤å€¼å’Œå·²ä¿®æ”¹çš„é…ç½®\n")

    print("âš™ï¸  show_config():")
    print("   â€¢ æ˜¾ç¤ºå½“å‰å®é™…ä½¿ç”¨çš„é…ç½®å€¼")
    print("   â€¢ è‡ªåŠ¨è¯†åˆ«é…ç½®é¡¹è¢«å“ªäº›æ’ä»¶ä½¿ç”¨")
    print("   â€¢ åŒºåˆ†å…¨å±€é…ç½®ã€æ’ä»¶ç‰¹å®šé…ç½®å’Œæœªä½¿ç”¨é…ç½®")
    print("   â€¢ é€‚åˆè¯Šæ–­é…ç½®é—®é¢˜\n")

    # ====================================================================
    # 9. æ¼”ç¤ºé…ç½®é”™è¯¯æ£€æµ‹
    # ====================================================================
    print("\n\næ­¥éª¤ 9: æ¼”ç¤ºé…ç½®é”™è¯¯æ£€æµ‹")
    print("-" * 80)
    print("è®¾ç½®ä¸€ä¸ªæ‹¼å†™é”™è¯¯çš„é…ç½®é¡¹ï¼ˆæœªè¢«ä»»ä½•æ’ä»¶ä½¿ç”¨ï¼‰:")
    print("  - n_chanels: 8  # æ­£ç¡®åº”è¯¥æ˜¯ n_channels")

    ctx.set_config({'n_chanels': 8})  # æ•…æ„æ‹¼å†™é”™è¯¯
    print("\nâœ“ é…ç½®å·²è®¾ç½®")

    print("\nä½¿ç”¨ show_config() å¯ä»¥å‘ç°è¿™ä¸ªé”™è¯¯...")
    input("\næŒ‰ Enter ç»§ç»­...")
    ctx.show_config()

    print("\n" + "=" * 80)
    print("ç¤ºä¾‹å®Œæˆï¼")
    print("=" * 80)


if __name__ == "__main__":
    main()
